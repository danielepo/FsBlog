
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Technology</title>
    <!-- FSharp.Formatting Styles -->
    <link rel="stylesheet" type="text/css" media="screen" href="http://techgroup.jet.com/fsharp.formatting/tooltips.css" />
    <script type="text/javascript" src="http://techgroup.jet.com/javascripts/video.fix.js"></script>
    <script type="text/javascript" src="http://techgroup.jet.com/javascripts/ga.js"></script>
    <script type="text/javascript" src="http://techgroup.jet.com/fsharp.formatting/tooltips.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript">var switchTo5x = true;</script>
    <script type="text/javascript" src="https://ws.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({ publisher: "81ce46a6-ba61-410c-bb73-5204cc8efed1", doNotHash: false, doNotCopy: false, hashAddressBar: true });</script>

    <link rel="stylesheet" href="http://techgroup.jet.com/stylesheets/styles.css">
    <link rel="stylesheet" href="http://techgroup.jet.com/stylesheets/pygment_trac.css">
    <link rel="shortcut icon" href="http://techgroup.jet.com/images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <header>
        <div>
            <a href="http://techgroup.jet.com/index.html" style="vertical-align:middle;"><img src="http://techgroup.jet.com/images/jet_logo.png" style="max-height:50px;" /></a><span class="subtitle">Technology</span>
            <div class="social">
                <ul>
                    <li>
                        <a class="social-icons" href="https://twitter.com/jettechnology"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://twitter.com/jet"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://www.facebook.com/jet"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://www.github.com/jet"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://linkedin.com/company/jet-com"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://plus.google.com/118328800025960082059/posts"></a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <leftpanel class="smaller">
        <h2>Jet is hiring!</h2>
        <p>
            <ol>
                <li><a href="https://jet.com/about-us/join-our-crew">Join our crew</a></li>
                <li><a href="http://careers.stackoverflow.com/jobs/employer/Jet.com">StackOverflow Careers</a></li>
                <li><a href="https://www.linkedin.com/vsearch/j?page_num=1&keywords=Jet%2Ecom&locationType=Y&f_C=5268907&trk=careers_promo_module_see_jobs">LinkedIn Jobs</a></li>
                <li><a href="http://www.indeed.com/cmp/Jet.com-3">Indeed Listings</a></li>
            </ol>
        </p>
<!--        <h2>Tags</h2>
            <a href="http://techgroup.jet.com/blog/tag/fsharp/index.html">f#</a>
            <a href="http://techgroup.jet.com/blog/tag/microservices/index.html">microservices</a>
            <a href="http://techgroup.jet.com/blog/tag/community/index.html">community</a>
            <a href="http://techgroup.jet.com/blog/tag/continuouslearning/index.html">continuouslearning</a>
            <a href="http://techgroup.jet.com/blog/tag/marketing-tech/index.html">marketing tech</a>
        <br />-->
        <h2>Videos we've watched</h2>
        <p>
            <ul>
                    <li><a href="http://techgroup.jet.com/videos/2015/08-17-cloud-scale-event-processing-using-rx/index.html">Cloud-scale Event Processing using Rx</a></li>
                    <li><a href="http://techgroup.jet.com/videos/2015/08-16-the-f-path-to-relaxation-don-syme-youtube/index.html">The F# Path to Relaxation - Don Syme - YouTube</a></li>
                    <li><a href="http://techgroup.jet.com/videos/2015/08-16-look-no-mocks-functional-tdd-with-f/index.html">Look, No Mocks! Functional TDD with F#</a></li>
            </ul>
        </p>
    </leftpanel>
    <section>
        
<h1>On how Jet chose F#</h1>
<div class="postbody">
    
<h2>In the beginning</h2>

<p>The first Jet prototype was written by our CTO, Mike Hanrahan, in his basement, in WCF. After the first developers were brought on, the first proper version of our site was spun up with CoffeeScript. However, Mike knew from the outset that he wanted to use F#, at least for the pricing engine, because of the benefits you often hear about F#: less code leading to fewer bugs, as well as code that is more robust and safer because of the type system, to name a few. As a company, we weren't sure that we should have F# anywhere else, though. After all, we're building an e-commerce web site. Isn't the web fully in the domain of C#? Plus, many of the developers on the team had an object-oriented or imperative background -- what if we wasted too much time figuring out this new language before we could even be productive?</p>

<p>So, we started building two solutions: a C# solution and an F# solution, to see where they would take us. In the end, we chose to stick with the F# path. The main reason: we were able to deliver the same functionality with far less code. This clearly eases maintainability and reduces bugs. If you've been part of the F# community for any length of time, you know that this is a very well known feature of the language and a commonly cited reason to switch to F#. However, we had a few other unique-to-Jet reasons that we wanted to share.</p>

<!--more-->

<h2>The user groups &amp; start-up scene</h2>

<p>In general, the developers who attend user groups do so because they are passionate about a certain technology, and they want to learn more by engaging and networking with the local community (this is certainly true of most of the user groups I've attended), but as we looked at F# user groups -- both locally in New York City and worldwide -- we realized something important: the number of attendees who were full-time F# developers was significantly lower than for other functional user groups.</p>

<p>Those of us who attend the F# user groups are not doing so to learn new tools for our day jobs, we're attending as hobbyists whose day jobs require other languages. We're driven by our passion for learning, for the language, and for the community. However, there is also a frustrating inability, in many cases, to find a day job that embraces the language and community about which we're so passionate. It struck us at Jet that these are exactly the types of engineers that any company would want to hire.</p>

<p>[Personally, as a developer, Jet is exactly the kind of company that I was looking to work for: a company that is passionate about technology and one that wants to invest in and build both our own developers, and the local community, as the company grows.]</p>

<p>In the same vein: as we looked around at the start-up scene in New York City, we noticed a surprising lack of start-ups betting on F#. The Scala and Clojure communities (for example), while larger to be sure, were no less passionate about their respective languages, and each community had several start-ups competing with each other over top developers. Less competition over top developers can only mean good things for Jet.</p>

<h2>Code</h2>

<h3>Aspect-oriented programming</h3>

<p>Like many large-scale projects, we needed a way to handle validation, logging, and other cross-cutting concerns. Traditionally in ASP.NET MVC, this is done through the use of Action Filters. To apply a filter to a single function (or a controller), you would simply decorate it with the relevant attribute. ASP.NET will then inject an extra call before your function call to handle authorization.</p>

<p>For example, to ensure authorization for an entire controller named MyController, you could use the following code:</p>

<table class="pre"><tr><td><pre lang="csharp">[Authorize]
<span class="k">public</span> <span class="k">class</span> MyController
{
    <span class="o">.</span><span class="o">.</span><span class="o">.</span>
}</pre></td></tr></table>

<p>An extremely similar implementation occurs for ASP.NET Web API: using attributes to inject an extra function call before your function. Other frameworks also utilize similar approaches. However, in Jet's case, we needed this same ability to handle cross-cutting concerns for services <strong>not</strong> based on HTTP. Unfortunately, after several attempts, we discovered this would prove extremely difficult to do in a generic way. Once we began to look to F#, we realized we would be able to cover our needs easily. As a bonus, we found we could do it in a way that neither pollutes the codebase with fabricated interfaces, nor requires adapting a specific architecture. And so we introduce:</p>

<h3>Jet's Filters Module</h3>

<p>In our filters module, rather than using attributes, we take a much more functional and composable approach to AOP. Any filter in our module can be used to decorate functions that have type <code>'Input -&gt; Async&lt;'Output&gt;</code>, and all filters in our module are composable, using our <code>andThen</code> operation, like so:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">compositeFilter</span> <span class="o">=</span> <span class="i">filter1</span> <span class="o">|&gt;</span> <span class="i">Filter</span><span class="o">.</span><span class="i">andThen</span> <span class="i">filter2</span></pre>
</td>
</tr>
</table>

<p>For example, if you had a service that simply echoes its output:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">echoService</span> <span class="o">:</span> <span class="i">Service</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">string</span>, <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">str</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">Return</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="i">str</span></pre>
</td>
</tr>
</table>

<p>and a filter that will print messages before and after a service is run:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">printBeforeAndAfterFilter</span> <span class="o">:</span> <span class="i">Filter</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs3', 10)" onmouseover="showTip(event, 'fs3', 10)" class="i">string</span>, <span onmouseout="hideTip(event, 'fs3', 11)" onmouseover="showTip(event, 'fs3', 11)" class="i">string</span><span class="o">&gt;</span> <span class="o">=</span> 
    <span class="i">Filter</span><span class="o">.</span><span class="i">beforeAfterSync</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">before</span><span class="s">&quot;</span>) (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 13)" onmouseover="showTip(event, 'fs8', 13)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">after</span><span class="s">&quot;</span>)</pre>
</td>
</tr>
</table>

<p>then, we can simply compose the two, and the messages will print before and after the service is invoked:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 14)" onmouseover="showTip(event, 'fs9', 14)" class="i">filteredEchoService</span> <span class="o">:</span> <span class="i">Service</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs3', 15)" onmouseover="showTip(event, 'fs3', 15)" class="i">string</span>, <span onmouseout="hideTip(event, 'fs3', 16)" onmouseover="showTip(event, 'fs3', 16)" class="i">string</span><span class="o">&gt;</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs7', 17)" onmouseover="showTip(event, 'fs7', 17)" class="i">printBeforeAndAfterFilter</span> <span class="o">|&gt;</span> <span class="i">Filter</span><span class="o">.</span><span class="i">apply</span> <span onmouseout="hideTip(event, 'fs2', 18)" onmouseover="showTip(event, 'fs2', 18)" class="i">echoService</span></pre>
</td>
</tr>
</table>

<p>This is clearly a very simple, intuitive, and effective way of handling filters.</p>

<h3>Category Theory</h3>

<p>And now, as a bonus for those of you who stuck with us this long: it happens that a filter is just a kleisli arrow specialized to the continuation monad.</p>

<p><img src="/images/monads-everywhere.jpg" alt="Monads. Monads everywhere." /></p>

<div class="tip" id="fs1">val compositeFilter : obj<br /><br />Full name: onhowjetchose.compositeFilter</div>
<div class="tip" id="fs2">val echoService : str:&#39;a -&gt; Async&lt;&#39;a&gt;<br /><br />Full name: onhowjetchose.echoService</div>
<div class="tip" id="fs3">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs4">val str : &#39;a</div>
<div class="tip" id="fs5">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs6">member AsyncBuilder.Return : value:&#39;T -&gt; Async&lt;&#39;T&gt;</div>
<div class="tip" id="fs7">val printBeforeAndAfterFilter : obj<br /><br />Full name: onhowjetchose.printBeforeAndAfterFilter</div>
<div class="tip" id="fs8">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs9">val filteredEchoService : obj<br /><br />Full name: onhowjetchose.filteredEchoService</div>

</div>
<span class='st_sharethis' displaytext='ShareThis'></span>
<span class='st_facebook' displaytext='Facebook'></span>
<span class='st_twitter' displaytext='Tweet'></span>
<span class='st_linkedin' displaytext='LinkedIn'></span>
<span class='st_googleplus' displaytext='Google +'></span>
<span class='st_pinterest' displaytext='Pinterest'></span>
<span class='st_email' displaytext='Email'></span>

    </section>
    <footer>
        <p><small>Hosted on GitHub Pages, using FsBlog. Because F# |> Jet <3.</small></p>
    </footer>
    <script src="http://techgroup.jet.com/javascripts/scale.fix.js"></script>
</body>
</html>
 