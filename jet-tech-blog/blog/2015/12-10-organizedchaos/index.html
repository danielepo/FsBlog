<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Technology</title>
    <!-- FSharp.Formatting Styles -->
    <link rel="stylesheet" type="text/css" media="screen" href="http://tech.jet.com/fsharp.formatting/tooltips.css" />
    <script type="text/javascript" src="http://tech.jet.com/javascripts/video.fix.js"></script>
    <script type="text/javascript" src="http://tech.jet.com/javascripts/ga.js"></script>
    <script type="text/javascript" src="http://tech.jet.com/fsharp.formatting/tooltips.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <link rel="stylesheet" href="http://tech.jet.com/stylesheets/styles.css">
    <link rel="stylesheet" href="http://tech.jet.com/stylesheets/pygment_trac.css">
    <link rel="shortcut icon" href="http://tech.jet.com/images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({publisher: "81ce46a6-ba61-410c-bb73-5204cc8efed1", doNotHash: true, doNotCopy: false, hashAddressBar: false});</script></head>
<body>
    <header>
        <div>
            <a href="http://tech.jet.com/index.html" style="vertical-align:middle;"><img src="http://tech.jet.com/images/jet_logo.png" style="max-height:50px;" /></a><span class="subtitle">Technology</span>
            <div class="social">
                <ul>
                    <li>
                        <a class="social-icons" href="https://twitter.com/jettechnology"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://twitter.com/jet"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://www.facebook.com/jet"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://www.github.com/jet"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://linkedin.com/company/jet-com"></a>
                    </li>
                    <li>
                        <a class="social-icons" href="https://plus.google.com/118328800025960082059/posts"></a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <leftpanel class="smaller">
        <h2><a href="https://jet.com/about-us/join-our-crew">Join us!</a></h2>

        <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/JetTechnology" data-widget-id="652521231367995392">Tweets by @JetTechnology</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        <br/><br/>

<!--       <h2>Tags</h2>
            <a href="http://tech.jet.com/blog/tag/fsharp/index.html">f#</a>
            <a href="http://tech.jet.com/blog/tag/community/index.html">community</a>
            <a href="http://tech.jet.com/blog/tag/microservices/index.html">microservices</a>
            <a href="http://tech.jet.com/blog/tag/jetdotcom/index.html">jet.com</a>
            <a href="http://tech.jet.com/blog/tag/jet-technology/index.html">jet technology</a>
            <a href="http://tech.jet.com/blog/tag/jetdotcom-technology/index.html">jet.com technology</a>
            <a href="http://tech.jet.com/blog/tag/azure/index.html">azure</a>
            <a href="http://tech.jet.com/blog/tag/cloud/index.html">cloud</a>
            <a href="http://tech.jet.com/blog/tag/continuous-learning/index.html">continuous learning</a>
            <a href="http://tech.jet.com/blog/tag/cloud-services/index.html">cloud services</a>
            <a href="http://tech.jet.com/blog/tag/micro-services/index.html">micro services</a>
            <a href="http://tech.jet.com/blog/tag/interview/index.html">interview</a>
            <a href="http://tech.jet.com/blog/tag/chaos-engineering/index.html">chaos engineering</a>
            <a href="http://tech.jet.com/blog/tag/performance-engineering/index.html">performance engineering</a>
            <a href="http://tech.jet.com/blog/tag/teaching/index.html">teaching</a>
            <a href="http://tech.jet.com/blog/tag/javascript/index.html">javascript</a>
            <a href="http://tech.jet.com/blog/tag/web-design/index.html">web design</a>
            <a href="http://tech.jet.com/blog/tag/technology/index.html">technology</a>
            <a href="http://tech.jet.com/blog/tag/marketing-tech/index.html">marketing tech</a>
        <br />-->
        <h2>Videos we <3</h2>
        <p>
            <ul>
                    <li><a href="http://tech.jet.com/videos/2015/12-16-why-your-team-has-slowed-down-why-that-s-worse-than-you-think-and-how-to-fix-it/index.html">Why Your Team Has Slowed Down, Why That's Worse than You Think, and How to Fix it</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/12-16-type-driven-development-mark-seemann-on-vimeo/index.html">Type-Driven Development - Mark Seemann on Vimeo</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/12-03-real-time-democratizing-of-event-driven-big-data-on-vimeo/index.html">REAL-TIME DEMOCRATIZING OF EVENT-DRIVEN BIG DATA on Vimeo</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/12-03-patterns-and-practices-for-real-world-event-driven-microservices-on-vimeo/index.html">PATTERNS AND PRACTICES FOR REAL-WORLD EVENT-DRIVEN MICROSERVICES on Vimeo</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/12-03-lambda-days-2015-evelina-gabasova-understanding-cancer-behaviour-with-f-on-vimeo/index.html">Lambda Days 2015 - Evelina Gabasova - Understanding cancer behaviour with F# on Vimeo</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/10-09-the-many-faces-of-apache-kafka-how-is-kafka-used-in-practice/index.html">The Many Faces of Apache Kafka: How is Kafka Used in Practice</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/10-09-journey-to-the-intelligent-cloud-azurecon-2015-channel-9/index.html">Journey to the intelligent cloud | AzureCon 2015 | Channel 9</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/09-02-the-next-generation-of-neural-networks/index.html">The Next Generation of Neural Networks</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/08-19-domain-driven-design-f-and-types-skillscast-13th-march-2014/index.html">Domain Driven Design, F# and Types | SkillsCast | 13th March 2014</a></li>
                    <li><a href="http://tech.jet.com/videos/2015/08-18-jet-com-kumail-nanjiani-explains-how-the-new-shopping-club-works/index.html">Jet.com - Kumail Nanjiani Explains How The New Shopping Club Works</a></li>
            </ul>
<!--            <small><a href="http://tech.jet.com/videos/">See all</a></small> -->
        </p>
    </leftpanel>
    <section>
        
<h1>Organized Chaos with F#</h1>
<small>
    Nora Jones &nbsp; &nbsp;| &nbsp; &nbsp;
    2015-12-15T03:21:57
        &nbsp;&nbsp;| &nbsp;&nbsp;f#, chaos engineering, performance engineering
</small>
<br />
<span class='st_reddit'></span>
<span class='st_facebook'></span>
<span class='st_twitter'></span>
<span class='st_linkedin'></span>
<span class='st_googleplus'></span>
<span class='st_tumblr'></span>
<span class='st_instapaper'></span>
<span class='st_email'></span>
<div class="postbody">
    
<img src="/images/chaosmonkey.png" style="width:400px;border-style:none;background:transparent;" />

<p>While we aim to increase productivity and efficiency among our engineers, we also want to ensure that we are prepared for anything (READ: we need to break lots of things before we release to the live production environment with which our customers interact) as a result, we've been injecting purposeful failure into our test environment.</p>

<p>For those who aren't familiar with the general topic, Chaos Monkey, coined by Netflix, helps developers test the resiliency of their applications by terminating their hosted Amazon Web Services instances at random (this helps ensure that individual components can work independently in a cloud-based system, but allows folks to see what happens when one component is taken out of the picture). Typically, as companies grow, so do the instances contained in their system, making it inevitably less resilient and more prone to failure. This failure comes from the combination of both human error and the likelihood that components of the cloud data center could go down at any given time.</p>

<p>Chaos in any cloud-based infrastructure involves an aspect of design creativity while keeping in mind both concurrency of components and independent failure of components. At the end of the day, if your services aren't reliable enough, you will inevitably lose customers, and that is what we are trying to avoid. As stated by many before, "The best way to avoid failure is to fail constantly."</p>

<p>If you use cloud-based technology, services are bound to go down in Production sometimes. We want to help teams be ready and prepared for the disruptions that may occur in Production environments. In other words, please have multiple worker roles in your cloud services. Our Chaos solution uses a <a href="http://www.dotnetperls.com/fisher-yates-shuffle">Knuth/Fisher-Yates Shuffle</a>, which creates a uniformly random permutation of the array of nodes fed into it; see the link for more information. We then use this permutation to select and restart instances in our test environment, especially for pre-Purple (Black) Friday as we geared up for holiday shopping.</p>

<h3>Azure+F#+Chaos=&lt;3</h3>

<p>The Jet engine is powered by F#, and it's always nice to keep technology uniform where possible. Our technology pioneers at Jet made it easier for Chaos testing to use <a href="https://opensource.com/resources/what-are-microservices">microservices</a>. The Jet tech team builds a ton of F# microservices that abstract away a lot of complexity - and using this, we are also able to log restarts to <a href="http://www.splunk.com/">Splunk</a> (more on this later).</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">compute</span>
<span class="o">|&gt;</span> <span class="i">knuthShuffle</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">distinctBy</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="i">a</span><span class="o">.</span><span class="i">ServiceName</span>) 
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">hostedService</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">async</span> { 
    <span class="k">try</span>
        <span class="k">return!</span> <span class="i">restartRandomInstance</span> <span class="i">compute</span> <span onmouseout="hideTip(event, 'fs7', 12)" onmouseover="showTip(event, 'fs7', 12)" class="i">hostedService</span>
    <span class="k">with</span> <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">e</span> <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">log</span><span class="o">.</span><span class="i">warn</span> <span class="s">&quot;</span><span class="s">failed</span><span class="s">:</span><span class="s"> </span><span class="s">service</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">.</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs7', 15)" onmouseover="showTip(event, 'fs7', 15)" class="i">hostedService</span><span class="o">.</span><span class="i">ServiceName</span> <span onmouseout="hideTip(event, 'fs9', 16)" onmouseover="showTip(event, 'fs9', 16)" class="i">e</span>
        <span class="k">return</span> ()
})
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="i">Async</span><span class="o">.</span><span class="i">ParallelIgnore</span> <span class="n">1</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="i">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="i">RunSynchronously</span></pre>
</td>
</tr>
</table>

<p>As mentioned by previous bloggers, our whole system is hosted on Microsoft Azure. With a quick Google search, you will notice that Azure has its own form of Chaos Monkey, called WazMonkey. While WazMonkey is very successful, we wanted to be able to stop instances rather than entire services (i.e. not bring down the entire cluster but instead bring down nodes). We also wanted to incorporate some of our in-house architecture while also using F# to eventually allow Chaos to be part of the continuous integration cycle (i.e. run it every day).</p>

<p>We have an AzureHelper module that allows us to access Azure's REST API through different libraries and perform tasks such as: getting deployment details (how many instances are contained in a particular cloud service), select a random instance, restart and instance, stop an instance, etc.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="i">selectRandomInstance</span> (<span onmouseout="hideTip(event, 'fs14', 21)" onmouseover="showTip(event, 'fs14', 21)" class="i">compute</span><span class="o">:</span><span class="i">ComputeManagementClient</span>) (<span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="i">hostedService</span><span class="o">:</span><span class="i">HostedServiceListResponse</span><span class="o">.</span><span class="i">HostedService</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 23)" onmouseover="showTip(event, 'fs8', 23)" class="i">async</span> {
    <span class="k">try</span>
        <span onmouseout="hideTip(event, 'fs10', 24)" onmouseover="showTip(event, 'fs10', 24)" class="i">log</span><span class="o">.</span><span class="i">info</span> <span class="s">&quot;</span><span class="s">Quering</span><span class="s"> </span><span class="s">cloud_service</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">for</span><span class="s"> </span><span class="s">instances</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs15', 25)" onmouseover="showTip(event, 'fs15', 25)" class="i">hostedService</span><span class="o">.</span><span class="i">ServiceName</span>
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="i">details</span> <span class="o">=</span> <span class="i">getHostedServiceDetails</span> <span onmouseout="hideTip(event, 'fs14', 27)" onmouseover="showTip(event, 'fs14', 27)" class="i">compute</span> <span onmouseout="hideTip(event, 'fs15', 28)" onmouseover="showTip(event, 'fs15', 28)" class="i">hostedService</span><span class="o">.</span><span class="i">ServiceName</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="i">deployment</span> <span class="o">=</span> <span class="i">getProductionDeployment</span> <span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="i">details</span>
            
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs17', 31)" onmouseover="showTip(event, 'fs17', 31)" class="i">deployment</span><span class="o">.</span><span class="i">RoleInstances</span><span class="o">.</span><span class="i">Count</span> <span class="k">with</span> 
        | <span class="n">1</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs10', 32)" onmouseover="showTip(event, 'fs10', 32)" class="i">log</span><span class="o">.</span><span class="i">warn</span> <span class="s">&quot;</span><span class="s">cloud_service</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">has</span><span class="s"> </span><span class="s">only</span><span class="s"> </span><span class="s">1</span><span class="s"> </span><span class="s">instance</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs15', 33)" onmouseover="showTip(event, 'fs15', 33)" class="i">hostedService</span><span class="o">.</span><span class="i">ServiceName</span>
        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs10', 34)" onmouseover="showTip(event, 'fs10', 34)" class="i">log</span><span class="o">.</span><span class="i">info</span> <span class="s">&quot;</span><span class="s">cloud_service</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">has</span><span class="s"> </span><span class="s">total_instances</span><span class="s">=</span><span class="s">%</span><span class="s">i</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs15', 35)" onmouseover="showTip(event, 'fs15', 35)" class="i">hostedService</span><span class="o">.</span><span class="i">ServiceName</span> <span onmouseout="hideTip(event, 'fs17', 36)" onmouseover="showTip(event, 'fs17', 36)" class="i">deployment</span><span class="o">.</span><span class="i">RoleInstances</span><span class="o">.</span><span class="i">Count</span>


        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 37)" onmouseover="showTip(event, 'fs18', 37)" class="i">instance</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 38)" onmouseover="showTip(event, 'fs17', 38)" class="i">deployment</span><span class="o">.</span><span class="i">RoleInstances</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 39)" onmouseover="showTip(event, 'fs3', 39)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 40)" onmouseover="showTip(event, 'fs19', 40)" class="i">toArray</span> <span class="o">|&gt;</span> <span class="i">randomPick</span>
        <span onmouseout="hideTip(event, 'fs10', 41)" onmouseover="showTip(event, 'fs10', 41)" class="i">log</span><span class="o">.</span><span class="i">info</span> <span class="s">&quot;</span><span class="s">Selected</span><span class="s"> </span><span class="s">cloud_service</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">instanceName</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">hostname</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs15', 42)" onmouseover="showTip(event, 'fs15', 42)" class="i">hostedService</span><span class="o">.</span><span class="i">ServiceName</span> <span onmouseout="hideTip(event, 'fs18', 43)" onmouseover="showTip(event, 'fs18', 43)" class="i">instance</span><span class="o">.</span><span class="i">InstanceName</span> <span onmouseout="hideTip(event, 'fs18', 44)" onmouseover="showTip(event, 'fs18', 44)" class="i">instance</span><span class="o">.</span><span class="i">HostName</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs16', 45)" onmouseover="showTip(event, 'fs16', 45)" class="i">details</span><span class="o">.</span><span class="i">ServiceName</span>, <span onmouseout="hideTip(event, 'fs17', 46)" onmouseover="showTip(event, 'fs17', 46)" class="i">deployment</span><span class="o">.</span><span class="i">Name</span>, <span onmouseout="hideTip(event, 'fs18', 47)" onmouseover="showTip(event, 'fs18', 47)" class="i">instance</span>
    <span class="k">with</span> <span onmouseout="hideTip(event, 'fs9', 48)" onmouseover="showTip(event, 'fs9', 48)" class="i">e</span> <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs10', 49)" onmouseover="showTip(event, 'fs10', 49)" class="i">log</span><span class="o">.</span><span class="i">error</span> <span class="s">&quot;</span><span class="s">Failed</span><span class="s"> </span><span class="s">selecting</span><span class="s"> </span><span class="s">random</span><span class="s"> </span><span class="s">instance</span><span class="s">\n</span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs9', 50)" onmouseover="showTip(event, 'fs9', 50)" class="i">e</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs20', 51)" onmouseover="showTip(event, 'fs20', 51)" class="i">raise</span> <span onmouseout="hideTip(event, 'fs9', 52)" onmouseover="showTip(event, 'fs9', 52)" class="i">e</span>
}

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 53)" onmouseover="showTip(event, 'fs21', 53)" class="i">restartRandomInstance</span> (<span onmouseout="hideTip(event, 'fs14', 54)" onmouseover="showTip(event, 'fs14', 54)" class="i">compute</span><span class="o">:</span><span class="i">ComputeManagementClient</span>) (<span onmouseout="hideTip(event, 'fs15', 55)" onmouseover="showTip(event, 'fs15', 55)" class="i">hostedService</span><span class="o">:</span><span class="i">HostedServiceListResponse</span><span class="o">.</span><span class="i">HostedService</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 56)" onmouseover="showTip(event, 'fs8', 56)" class="i">async</span> {
    <span class="k">try</span> 
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs22', 57)" onmouseover="showTip(event, 'fs22', 57)" class="i">serviceName</span>, <span onmouseout="hideTip(event, 'fs23', 58)" onmouseover="showTip(event, 'fs23', 58)" class="i">deploymentId</span>, <span onmouseout="hideTip(event, 'fs24', 59)" onmouseover="showTip(event, 'fs24', 59)" class="i">roleInstance</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 60)" onmouseover="showTip(event, 'fs13', 60)" class="i">selectRandomInstance</span> <span onmouseout="hideTip(event, 'fs14', 61)" onmouseover="showTip(event, 'fs14', 61)" class="i">compute</span> <span onmouseout="hideTip(event, 'fs15', 62)" onmouseover="showTip(event, 'fs15', 62)" class="i">hostedService</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs24', 63)" onmouseover="showTip(event, 'fs24', 63)" class="i">roleInstance</span><span class="o">.</span><span class="i">PowerState</span> <span class="k">with</span>
        | <span class="i">RoleInstancePowerState</span><span class="o">.</span><span class="i">Stopped</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs10', 64)" onmouseover="showTip(event, 'fs10', 64)" class="i">log</span><span class="o">.</span><span class="i">info</span> <span class="s">&quot;</span><span class="s">Service</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">Instance</span><span class="s">=</span><span class="s">%</span><span class="s">s</span><span class="s"> </span><span class="s">is</span><span class="s"> </span><span class="s">stopped</span><span class="s">.</span><span class="s">.</span><span class="s">.</span><span class="s">ignoring</span><span class="s">.</span><span class="s">.</span><span class="s">.</span><span class="s">&quot;</span> <span class="i">serviceName</span> <span onmouseout="hideTip(event, 'fs24', 65)" onmouseover="showTip(event, 'fs24', 65)" class="i">roleInstance</span><span class="o">.</span><span class="i">InstanceName</span>
                
        | _ <span class="k">-&gt;</span>
            <span class="k">do!</span> <span class="i">restartInstance</span> <span onmouseout="hideTip(event, 'fs14', 66)" onmouseover="showTip(event, 'fs14', 66)" class="i">compute</span> <span class="i">serviceName</span> <span class="i">deploymentId</span> <span onmouseout="hideTip(event, 'fs24', 67)" onmouseover="showTip(event, 'fs24', 67)" class="i">roleInstance</span><span class="o">.</span><span class="i">InstanceName</span>
    <span class="k">with</span> <span onmouseout="hideTip(event, 'fs9', 68)" onmouseover="showTip(event, 'fs9', 68)" class="i">e</span> <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs10', 69)" onmouseover="showTip(event, 'fs10', 69)" class="i">log</span><span class="o">.</span><span class="i">error</span> <span class="s">&quot;</span><span class="s">%</span><span class="s">s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs9', 70)" onmouseover="showTip(event, 'fs9', 70)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 71)" onmouseover="showTip(event, 'fs25', 71)" class="i">Message</span>
}</pre>
</td>
</tr>
</table>

<h3>Socialization</h3>

<p>Teams at Jet operate independently and have complete end-to-end responsibility for what they build. These teams own their product lifecycle from inception to deployment. To say that engineers were completely on board with Chaos Engineering would be a fallacy. But, with any new tool, idea or application comes the aspect of socialization and there has been work getting folks to realize the positive impact Chaos Engineering could have on the strength of the environment. Our Chaos solution is run on an automated schedule between 9 AM - 5 PM during the week. We chose business hours to give engineers the opportunity to react quickly when something unexpected happens.</p>

<h3>How do we know the effect the restarts have on the site?</h3>

<p>Other than following the scream of a developer ;) we have automated critical-path tests running throughout the day, these tests encompass both general performance tests (GETs and POSTs) as well as front-end JavaScript tests. The critical path tests enable us to abstract information from obscure tests, and pinpoint it to a particular time an instance from a cloud service was started, allowing us to more easily root-cause an error before it reaches Production. Good logging is key for any chaos system to have a positive impact; if chaos causes degradation to services, we need proper notifications in order to investigate and Splunk allows us to do this. We certainly have plenty more we want to do with Chaos, and more that we think it is capable of - this is simply the beginning.</p>

<div class="tip" id="fs1">namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs2">namespace System</div>
<div class="tip" id="fs3">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs4">val distinctBy : projection:(&#39;T -&gt; &#39;Key) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt; (requires equality)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.distinctBy</div>
<div class="tip" id="fs5">val a : obj</div>
<div class="tip" id="fs6">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs7">val hostedService : obj</div>
<div class="tip" id="fs8">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs9">val e : exn</div>
<div class="tip" id="fs10">val log : value:&#39;T -&gt; &#39;T (requires member Log)<br /><br />Full name: Microsoft.FSharp.Core.Operators.log</div>
<div class="tip" id="fs11">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs12">static member Async.RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:System.Threading.CancellationToken -&gt; &#39;T</div>
<div class="tip" id="fs13">val selectRandomInstance : compute:&#39;a -&gt; hostedService:&#39;b -&gt; Async&lt;&#39;c * &#39;d * &#39;e&gt;<br /><br />Full name: 12-10-organizedchaos_.selectRandomInstance</div>
<div class="tip" id="fs14">val compute : &#39;a</div>
<div class="tip" id="fs15">val hostedService : &#39;b</div>
<div class="tip" id="fs16">val details : obj</div>
<div class="tip" id="fs17">val deployment : obj</div>
<div class="tip" id="fs18">val instance : &#39;e</div>
<div class="tip" id="fs19">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs20">val raise : exn:System.Exception -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.raise</div>
<div class="tip" id="fs21">val restartRandomInstance : compute:&#39;a -&gt; hostedService:&#39;b -&gt; Async&lt;unit&gt;<br /><br />Full name: 12-10-organizedchaos_.restartRandomInstance</div>
<div class="tip" id="fs22">val serviceName : obj</div>
<div class="tip" id="fs23">val deploymentId : obj</div>
<div class="tip" id="fs24">val roleInstance : obj</div>
<div class="tip" id="fs25">property System.Exception.Message: string</div>

</div>
<span class='st_reddit'></span>
<span class='st_facebook'></span>
<span class='st_twitter'></span>
<span class='st_linkedin'></span>
<span class='st_googleplus'></span>
<span class='st_tumblr'></span>
<span class='st_instapaper'></span>
<span class='st_email'></span>

    </section>
    <footer>
        <p><small>Hosted on Azure, using FsBlog. Because F# + Azure |> Jet <3.</small></p>
    </footer>
    <script src="http://tech.jet.com/javascripts/scale.fix.js"></script>
</body>
</html>
